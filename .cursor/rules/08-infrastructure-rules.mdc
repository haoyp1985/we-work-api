---
alwaysApply: true
---
```

## ğŸ—„ï¸ æ•°æ®åº“éƒ¨ç½²è§„èŒƒ

### 1. MySQLé…ç½®ä¼˜åŒ–
```ini
# âœ… my.cnfç”Ÿäº§ç¯å¢ƒé…ç½®
[mysqld]
# åŸºç¡€é…ç½®
port = 3306
socket = /var/run/mysqld/mysqld.sock
pid-file = /var/run/mysqld/mysqld.pid
datadir = /var/lib/mysql

# å­—ç¬¦é›†é…ç½®
character-set-server = utf8mb4
collation-server = utf8mb4_unicode_ci
init_connect = 'SET NAMES utf8mb4'

# è¿æ¥é…ç½®
max_connections = 200
max_connect_errors = 1000
wait_timeout = 28800
interactive_timeout = 28800

# ç¼“å­˜é…ç½®
innodb_buffer_pool_size = 512M
innodb_log_file_size = 128M
innodb_log_buffer_size = 16M
innodb_flush_log_at_trx_commit = 1
innodb_flush_method = O_DIRECT

# æŸ¥è¯¢ç¼“å­˜
query_cache_type = 1
query_cache_size = 64M
query_cache_limit = 2M

# æ…¢æŸ¥è¯¢æ—¥å¿—
slow_query_log = 1
slow_query_log_file = /var/log/mysql/slow.log
long_query_time = 2
log_queries_not_using_indexes = 1

# äºŒè¿›åˆ¶æ—¥å¿—
log-bin = mysql-bin
binlog_format = ROW
expire_logs_days = 7
max_binlog_size = 100M

# é”™è¯¯æ—¥å¿—
log-error = /var/log/mysql/error.log

# å®‰å…¨é…ç½®
local-infile = 0
skip-symbolic-links
```

### 2. Redisé…ç½®ä¼˜åŒ–
```ini
# âœ… redis.confç”Ÿäº§ç¯å¢ƒé…ç½®
# åŸºç¡€é…ç½®
port 6379
bind 0.0.0.0
protected-mode yes
requirepass wework_redis_2024

# å†…å­˜é…ç½®
maxmemory 256mb
maxmemory-policy allkeys-lru

# æŒä¹…åŒ–é…ç½®
save 900 1
save 300 10
save 60 10000
stop-writes-on-bgsave-error yes
rdbcompression yes
rdbchecksum yes
dbfilename dump.rdb

# AOFé…ç½®
appendonly yes
appendfilename "appendonly.aof"
appendfsync everysec
no-appendfsync-on-rewrite no
auto-aof-rewrite-percentage 100
auto-aof-rewrite-min-size 64mb

# æ—¥å¿—é…ç½®
loglevel notice
logfile /var/log/redis/redis-server.log
syslog-enabled yes
syslog-ident redis

# ç½‘ç»œé…ç½®
timeout 300
tcp-keepalive 300
tcp-backlog 511

# å®¢æˆ·ç«¯é…ç½®
maxclients 10000
```

## ğŸ“¦ ä¸­é—´ä»¶éƒ¨ç½²è§„èŒƒ

### 1. RocketMQé…ç½®
```properties
# âœ… broker.confé…ç½®
# é›†ç¾¤åç§°
brokerClusterName = DefaultCluster
brokerName = broker-a
brokerId = 0

# ç½‘ç»œé…ç½®
listenPort = 10911
namesrvAddr = rocketmq-nameserver:9876

# å­˜å‚¨é…ç½®
storePathRootDir = /opt/store
storePathCommitLog = /opt/store/commitlog
storePathConsumeQueue = /opt/store/consumequeue
storePathIndex = /opt/store/index

# æ€§èƒ½é…ç½®
defaultTopicQueueNums = 4
autoCreateTopicEnable = true
autoCreateSubscriptionGroup = true

# æ¸…ç†é…ç½®
fileReservedTime = 72
deleteWhen = 04
diskMaxUsedSpaceRatio = 88

# ç½‘ç»œé…ç½®
brokerIP1 = 0.0.0.0
```

### 2. Nacosé…ç½®
```yaml
# âœ… nacosé…ç½®
server:
  port: 8848

spring:
  datasource:
    platform: mysql
    db:
      num: 1
      url:
        0: jdbc:mysql://mysql:3306/nacos_config?characterEncoding=utf8&connectTimeout=1000&socketTimeout=3000&autoReconnect=true&useUnicode=true&useSSL=false&serverTimezone=Asia/Shanghai
      username:
        0: nacos
      password:
        0: nacos123456

nacos:
  security:
    ignore:
      urls: /,/error,/**/*.css,/**/*.js,/**/*.html,/**/*.map,/**/*.svg,/**/*.png,/**/*.ico,/console-ui/public/**,/v1/auth/**,/v1/console/health/**,/actuator/**,/v1/console/server/**
  core:
    auth:
      system:
        type: nacos
        token:
          secret:
            key: VGhpc0lzTXlDdXN0b21TZWNyZXRLZXkwMTIzNDU2Nzg5QUJDREVGMDEyMzQ1Njc4OUFCQ0RFRg==
      enabled: true
      enable:
        userAgentAuthWhite: false
      plugin:
        nacos:
          token:
            expire:
              seconds: 18000
  istio:
    mcp:
      server:
        enabled: false
```

## ğŸ” ç¯å¢ƒç®¡ç†è§„èŒƒ

### 1. ç¯å¢ƒé…ç½®
```bash
# âœ… ç¯å¢ƒå˜é‡é…ç½®
# å¼€å‘ç¯å¢ƒ (.env.dev)
PROFILE=dev
MYSQL_ROOT_PASSWORD=dev123456
MYSQL_USER=wework_dev
MYSQL_PASSWORD=dev123456
REDIS_PASSWORD=dev_redis_2024
NACOS_SERVER=localhost:8848
NACOS_NAMESPACE=dev

# æµ‹è¯•ç¯å¢ƒ (.env.test)
PROFILE=test
MYSQL_ROOT_PASSWORD=test123456
MYSQL_USER=wework_test
MYSQL_PASSWORD=test123456
REDIS_PASSWORD=test_redis_2024
NACOS_SERVER=nacos-test:8848
NACOS_NAMESPACE=test

# ç”Ÿäº§ç¯å¢ƒ (.env.prod)
PROFILE=prod
MYSQL_ROOT_PASSWORD=${MYSQL_ROOT_PASSWORD}
MYSQL_USER=wework_prod
MYSQL_PASSWORD=${MYSQL_PASSWORD}
REDIS_PASSWORD=${REDIS_PASSWORD}
NACOS_SERVER=nacos-cluster:8848
NACOS_NAMESPACE=prod
```

### 2. èµ„æºé™åˆ¶é…ç½®
```yaml
# âœ… èµ„æºé™åˆ¶æ ‡å‡†
deploy:
  resources:
    # ç½‘å…³æœåŠ¡
    gateway-service:
      limits:
        memory: 1Gi
        cpu: 1000m
      reservations:
        memory: 512Mi
        cpu: 500m
    
    # ä¸šåŠ¡æœåŠ¡
    account-service:
      limits:
        memory: 800Mi
        cpu: 800m
      reservations:
        memory: 400Mi
        cpu: 400m
    
    # æ•°æ®åº“
    mysql:
      limits:
        memory: 1Gi
        cpu: 1000m
      reservations:
        memory: 512Mi
        cpu: 500m
    
    # ç¼“å­˜
    redis:
      limits:
        memory: 256Mi
        cpu: 200m
      reservations:
        memory: 128Mi
        cpu: 100m
```

**è§„åˆ™æ€»ç»“**:
- ä½¿ç”¨Docker Composeç»Ÿä¸€ç¼–æ’æ‰€æœ‰åŸºç¡€è®¾æ–½
- é…ç½®å®Œæ•´çš„ç›‘æ§ä½“ç³»(Prometheus + Grafana + å‘Šè­¦)
- æ•°æ®åº“å’Œä¸­é—´ä»¶å¿…é¡»ä¼˜åŒ–é…ç½®å‚æ•°
- å®ç°å¤šç¯å¢ƒé…ç½®ç®¡ç†å’Œèµ„æºé™åˆ¶
- æ‰€æœ‰æœåŠ¡å¿…é¡»é…ç½®å¥åº·æ£€æŸ¥å’Œæ—¥å¿—æ”¶é›†