---
alwaysApply: true
---

# ğŸ’¾ æ•°æ®åº“è®¾è®¡å’Œæ“ä½œè§„åˆ™

## ğŸ“Š æ•°æ®åº“è®¾è®¡è§„èŒƒ

### 1. è¡¨è®¾è®¡è§„èŒƒ
```sql
-- âœ… æ­£ç¡®çš„è¡¨è®¾è®¡æ¨¡æ¿
CREATE TABLE {business_entity} (
    -- ä¸»é”®è®¾è®¡
    id VARCHAR(36) PRIMARY KEY COMMENT 'ä¸»é”®ID(UUID)',
    
    -- å¤šç§Ÿæˆ·å­—æ®µ(å¿…é¡»)
    tenant_id VARCHAR(36) NOT NULL COMMENT 'ç§Ÿæˆ·ID',
    
    -- ä¸šåŠ¡å­—æ®µ
    {business_field} VARCHAR(100) NOT NULL COMMENT 'ä¸šåŠ¡å­—æ®µ',
    
    -- çŠ¶æ€å­—æ®µ
    status ENUM('active', 'inactive', 'deleted') DEFAULT 'active' COMMENT 'çŠ¶æ€',
    
    -- å®¡è®¡å­—æ®µ(å¿…é¡»)
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    created_by VARCHAR(36) DEFAULT NULL COMMENT 'åˆ›å»ºäººID',
    updated_by VARCHAR(36) DEFAULT NULL COMMENT 'æ›´æ–°äººID',
    
    -- è½¯åˆ é™¤å­—æ®µ
    deleted_at TIMESTAMP NULL DEFAULT NULL COMMENT 'åˆ é™¤æ—¶é—´',
    
    -- ç‰ˆæœ¬æ§åˆ¶(å¯é€‰)
    version INT DEFAULT 1 COMMENT 'ç‰ˆæœ¬å·',
    
    -- ç´¢å¼•è®¾è®¡
    INDEX idx_tenant_id (tenant_id),
    INDEX idx_status (status),
    INDEX idx_created_at (created_at),
    INDEX idx_tenant_status (tenant_id, status),
    
    -- å¤–é”®çº¦æŸ
    FOREIGN KEY (tenant_id) REFERENCES saas_tenants(id) ON DELETE CASCADE
    
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci 
  COMMENT='{è¡¨çš„ä¸­æ–‡æè¿°}';
```

**è§„åˆ™**:
- ä¸»é”®ç»Ÿä¸€ä½¿ç”¨VARCHAR(36)å­˜å‚¨UUID
- æ‰€æœ‰ä¸šåŠ¡è¡¨å¿…é¡»åŒ…å«tenant_idå­—æ®µ
- å¿…é¡»åŒ…å«created_atã€updated_atå®¡è®¡å­—æ®µ
- ä½¿ç”¨è½¯åˆ é™¤ï¼Œæ·»åŠ deleted_atå­—æ®µ
- è¡¨åå’Œå­—æ®µåä½¿ç”¨snake_caseå‘½åæ³•
- å¿…é¡»æ·»åŠ è¡¨å’Œå­—æ®µçš„COMMENTæ³¨é‡Š

### 2. å‘½åè§„èŒƒ
```sql
-- âœ… æ­£ç¡®çš„å‘½å
è¡¨å: wework_accounts, message_templates, tenant_quotas
å­—æ®µå: tenant_id, account_name, created_at, is_active
ç´¢å¼•å: idx_tenant_id, idx_status, idx_tenant_status
å¤–é”®å: fk_accounts_tenant_id

-- âŒ é”™è¯¯çš„å‘½å  
è¡¨å: WeWorkAccount, messageTemplate, TenantQuota
å­—æ®µå: tenantId, accountName, createdAt, isActive
ç´¢å¼•å: index1, idx1, tenant_index
å¤–é”®å: fk1, foreign_key_1
```

**è§„åˆ™**:
- è¡¨åä½¿ç”¨å¤æ•°å½¢å¼
- å­—æ®µåæè¿°æ€§å¼ºï¼Œé¿å…ç¼©å†™
- ç´¢å¼•åä»¥idx_å¼€å¤´ï¼Œæè¿°åŒ…å«çš„å­—æ®µ
- å¤–é”®åä»¥fk_å¼€å¤´ï¼Œè¡¨æ˜å…³è”å…³ç³»

### 3. æ•°æ®ç±»å‹è§„èŒƒ
```sql
-- âœ… æ­£ç¡®çš„æ•°æ®ç±»å‹é€‰æ‹©
id VARCHAR(36)              -- UUIDä¸»é”®
tenant_id VARCHAR(36)       -- å¤–é”®ID
name VARCHAR(100)           -- çŸ­æ–‡æœ¬
description TEXT            -- é•¿æ–‡æœ¬  
config JSON                 -- å¤æ‚é…ç½®
amount DECIMAL(10,2)        -- é‡‘é¢
count INT                   -- è®¡æ•°
is_active BOOLEAN           -- å¸ƒå°”å€¼
created_at TIMESTAMP        -- æ—¶é—´æˆ³
status ENUM('active','inactive') -- çŠ¶æ€æšä¸¾

-- âŒ é”™è¯¯çš„æ•°æ®ç±»å‹
id INT AUTO_INCREMENT       -- ä¸ä½¿ç”¨è‡ªå¢ID
name VARCHAR(255)           -- è¿‡é•¿çš„å­—ç¬¦ä¸²
config TEXT                 -- åº”è¯¥ç”¨JSON
amount FLOAT                -- ç²¾åº¦é—®é¢˜
created_at DATETIME         -- åº”è¯¥ç”¨TIMESTAMP
```

**è§„åˆ™**:
- ä¸»é”®å’Œå¤–é”®ç»Ÿä¸€ä½¿ç”¨VARCHAR(36)
- çŸ­æ–‡æœ¬å­—æ®µæ ¹æ®å®é™…éœ€è¦è®¾ç½®é•¿åº¦
- é…ç½®ä¿¡æ¯ä½¿ç”¨JSONç±»å‹
- é‡‘é¢ä½¿ç”¨DECIMALç±»å‹
- æ—¶é—´å­—æ®µä½¿ç”¨TIMESTAMPç±»å‹
- çŠ¶æ€å­—æ®µä½¿ç”¨ENUMç±»å‹

## ğŸ—ï¸ åˆ†åº“åˆ†è¡¨è§„åˆ™

### 1. æ•°æ®åº“æ‹†åˆ†ç­–ç•¥
```yaml
æ•°æ®åº“æ‹†åˆ†è§„èŒƒ:
  saas_unified_core:
    - ç”¨é€”: ç»Ÿä¸€èº«ä»½è®¤è¯ã€æƒé™ç®¡ç†ã€ç³»ç»Ÿé…ç½®
    - ç‰¹ç‚¹: æ•°æ®é‡ç›¸å¯¹è¾ƒå°ï¼ŒæŸ¥è¯¢é¢‘ç¹
    - è¡¨æ•°: 24å¼ è¡¨
    
  ai_agent_platform:  
    - ç”¨é€”: AIæ™ºèƒ½ä½“ç®¡ç†ã€è°ƒåº¦ã€ç›‘æ§
    - ç‰¹ç‚¹: å¤æ‚ä¸šåŠ¡é€»è¾‘ï¼Œéœ€è¦ä¿ç•™å®Œæ•´åŠŸèƒ½
    - è¡¨æ•°: 20å¼ è¡¨
    
  wework_platform:
    - ç”¨é€”: ä¼å¾®è´¦å·ç®¡ç†ã€çŠ¶æ€è·Ÿè¸ª
    - ç‰¹ç‚¹: 9ç§çŠ¶æ€è·Ÿè¸ªï¼Œç”Ÿå‘½å‘¨æœŸç®¡ç†
    - è¡¨æ•°: 15å¼ è¡¨
    
  health_management:
    - ç”¨é€”: å¥åº·ç®¡ç†ã€ä½“æ£€é¢„çº¦
    - ç‰¹ç‚¹: ä¸šåŠ¡ç›¸å¯¹ç‹¬ç«‹
    - è¡¨æ•°: 12å¼ è¡¨
    
  core_business:
    - ç”¨é€”: æœåŠ¡äº§å“ã€è®¢å•ã€è¥é”€
    - ç‰¹ç‚¹: äº¤æ˜“æ ¸å¿ƒï¼Œé«˜å¹¶å‘è®¿é—®
    - è¡¨æ•°: 15å¼ è¡¨
    
  customer_management:
    - ç”¨é€”: å®¢æˆ·ç®¡ç†ã€æ ‡ç­¾ã€åˆ†ç¾¤
    - ç‰¹ç‚¹: æ•°æ®åˆ†æéœ€æ±‚è¾ƒå¤§
    - è¡¨æ•°: 12å¼ è¡¨
```

**è§„åˆ™**:
- æŒ‰ä¸šåŠ¡åŸŸè¿›è¡Œæ•°æ®åº“æ‹†åˆ†
- é¿å…è·¨åº“JOINæŸ¥è¯¢
- é€šè¿‡æœåŠ¡è°ƒç”¨å®ç°è·¨åº“æ•°æ®è·å–

### 2. åˆ†åŒºè¡¨è®¾è®¡
```sql
-- âœ… å¤§æ•°æ®é‡è¡¨ä½¿ç”¨åˆ†åŒº
CREATE TABLE message_records (
    id VARCHAR(36) PRIMARY KEY,
    tenant_id VARCHAR(36) NOT NULL,
    content TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_tenant_created (tenant_id, created_at)
) ENGINE=InnoDB
  PARTITION BY RANGE (UNIX_TIMESTAMP(created_at)) (
    PARTITION p202401 VALUES LESS THAN (UNIX_TIMESTAMP('2024-02-01')),
    PARTITION p202402 VALUES LESS THAN (UNIX_TIMESTAMP('2024-03-01')),
    PARTITION p202403 VALUES LESS THAN (UNIX_TIMESTAMP('2024-04-01')),
    PARTITION p_future VALUES LESS THAN MAXVALUE
);
```

**è§„åˆ™**:
- å¤§æ•°æ®é‡è¡¨(>1000ä¸‡è¡Œ)å¿…é¡»ä½¿ç”¨åˆ†åŒº
- ä¼˜å…ˆæŒ‰æ—¶é—´åˆ†åŒºï¼Œä¾¿äºæ•°æ®æ¸…ç†
- é¢„åˆ›å»ºæœªæ¥åˆ†åŒºï¼Œé¿å…æ•°æ®æ’å…¥å¤±è´¥

## ğŸ’½ ç´¢å¼•ä¼˜åŒ–è§„åˆ™

### 1. ç´¢å¼•è®¾è®¡åŸåˆ™
```sql
-- âœ… æ­£ç¡®çš„ç´¢å¼•è®¾è®¡
-- å•åˆ—ç´¢å¼•
INDEX idx_tenant_id (tenant_id),
INDEX idx_status (status),
INDEX idx_created_at (created_at),

-- å¤åˆç´¢å¼•(æœ€å¸¸ç”¨æŸ¥è¯¢æ¡ä»¶åœ¨å‰)
INDEX idx_tenant_status (tenant_id, status),
INDEX idx_tenant_created (tenant_id, created_at),
INDEX idx_tenant_status_created (tenant_id, status, created_at),

-- è¦†ç›–ç´¢å¼•(åŒ…å«SELECTå­—æ®µ)
INDEX idx_tenant_cover (tenant_id, status, name, created_at),

-- âŒ é”™è¯¯çš„ç´¢å¼•è®¾è®¡
INDEX idx_bad1 (created_at, tenant_id),  -- é¡ºåºé”™è¯¯
INDEX idx_bad2 (name, description),      -- ä½é€‰æ‹©æ€§å­—æ®µåœ¨å‰
INDEX idx_redundant (tenant_id),         -- å·²å­˜åœ¨å¤åˆç´¢å¼•
```

**è§„åˆ™**:
- é«˜é€‰æ‹©æ€§å­—æ®µåœ¨å‰(tenant_idä¼˜å…ˆ)
- æŸ¥è¯¢æ¡ä»¶å­—æ®µåœ¨å‰ï¼Œæ’åºå­—æ®µåœ¨å
- é¿å…è¿‡å¤šç´¢å¼•ï¼Œå½±å“å†™å…¥æ€§èƒ½
- å®šæœŸåˆ†ææ…¢æŸ¥è¯¢ï¼Œä¼˜åŒ–ç´¢å¼•

### 2. æŸ¥è¯¢ä¼˜åŒ–è§„èŒƒ
```sql
-- âœ… æ­£ç¡®çš„æŸ¥è¯¢å†™æ³•
SELECT id, name, status, created_at 
FROM wework_accounts 
WHERE tenant_id = ? 
  AND status = 'active' 
  AND created_at >= ?
ORDER BY created_at DESC 
LIMIT 20;

-- âŒ é”™è¯¯çš„æŸ¥è¯¢å†™æ³•
SELECT * FROM wework_accounts           -- é¿å…SELECT *
WHERE name LIKE '%keyword%'             -- é¿å…å·¦æ¨¡ç³ŠæŸ¥è¯¢
  OR description LIKE '%keyword%'       -- é¿å…ORæŸ¥è¯¢
ORDER BY created_at                     -- ç¼ºå°‘LIMIT
```

**è§„åˆ™**:
- é¿å…SELECT *ï¼Œæ˜ç¡®æŒ‡å®šå­—æ®µ
- WHEREæ¡ä»¶å¿…é¡»åŒ…å«tenant_id
- é¿å…å·¦æ¨¡ç³ŠæŸ¥è¯¢å’ŒORæ¡ä»¶
- å¤§ç»“æœé›†å¿…é¡»ä½¿ç”¨LIMITåˆ†é¡µ

## ğŸ”„ æ•°æ®æ“ä½œè§„èŒƒ

### 1. äº‹åŠ¡å¤„ç†
```java
// âœ… æ­£ç¡®çš„äº‹åŠ¡å¤„ç†
@Service
@Transactional(rollbackFor = Exception.class)
public class AccountService {
    
    // åªè¯»äº‹åŠ¡
    @Transactional(readOnly = true)
    public AccountDTO getAccount(String tenantId, String accountId) {
        return accountMapper.selectByTenantAndId(tenantId, accountId);
    }
    
    // å†™äº‹åŠ¡
    @Transactional(rollbackFor = Exception.class)
    public void createAccount(CreateAccountRequest request) {
        // 1. éªŒè¯æƒé™
        tenantQuotaService.checkAccountQuota(request.getTenantId());
        
        // 2. åˆ›å»ºè´¦å·
        WeWorkAccount account = new WeWorkAccount();
        account.setTenantId(request.getTenantId());
        accountMapper.insert(account);
        
        // 3. è®°å½•å®¡è®¡æ—¥å¿—
        auditLogService.logAccountCreated(account);
        
        // 4. å‘é€äº‹ä»¶
        eventPublisher.publishAccountCreated(account);
    }
}
```

**è§„åˆ™**:
- æ˜ç¡®æŒ‡å®šrollbackFor = Exception.class
- æŸ¥è¯¢æ“ä½œä½¿ç”¨readOnly = true
- äº‹åŠ¡èŒƒå›´å°½å¯èƒ½å°ï¼Œé¿å…é•¿äº‹åŠ¡
- äº‹åŠ¡å†…é¿å…è°ƒç”¨å¤–éƒ¨æœåŠ¡

### 2. æ‰¹é‡æ“ä½œ
```java
// âœ… æ­£ç¡®çš„æ‰¹é‡æ“ä½œ
@Service
public class MessageService {
    
    public void batchCreateMessages(List<MessageDTO> messages) {
        if (CollectionUtils.isEmpty(messages)) {
            return;
        }
        
        // åˆ†æ‰¹å¤„ç†ï¼Œé¿å…å¤§äº‹åŠ¡
        int batchSize = 100;
        for (int i = 0; i < messages.size(); i += batchSize) {
            int end = Math.min(i + batchSize, messages.size());
            List<MessageDTO> batch = messages.subList(i, end);
            batchInsertMessages(batch);
        }
    }
    
    @Transactional(rollbackFor = Exception.class)
    private void batchInsertMessages(List<MessageDTO> batch) {
        messageMapper.batchInsert(batch);
    }
}
```

**è§„åˆ™**:
- å¤§æ‰¹é‡æ“ä½œåˆ†æ‰¹å¤„ç†ï¼Œå•æ‰¹æ¬¡ä¸è¶…è¿‡1000æ¡
- ä½¿ç”¨MyBatis-Plusçš„æ‰¹é‡æ’å…¥åŠŸèƒ½
- æ‰¹é‡æ“ä½œå‰éªŒè¯ç§Ÿæˆ·æƒé™

### 3. ç¼“å­˜ç­–ç•¥
```java
// âœ… æ­£ç¡®çš„ç¼“å­˜ä½¿ç”¨
@Service
public class ConfigService {
    
    @Cacheable(value = "tenant-config", key = "#tenantId")
    public TenantConfigDTO getTenantConfig(String tenantId) {
        return configMapper.selectByTenantId(tenantId);
    }
    
    @CacheEvict(value = "tenant-config", key = "#config.tenantId")
    public void updateTenantConfig(TenantConfigDTO config) {
        configMapper.updateByTenantId(config);
    }
    
    @CacheEvict(value = "tenant-config", allEntries = true)
    public void clearAllCache() {
        // æ¸…ç©ºæ‰€æœ‰ç¼“å­˜
    }
}
```

**è§„åˆ™**:
- é…ç½®ä¿¡æ¯ä½¿ç”¨ç¼“å­˜ï¼Œæå‡æŸ¥è¯¢æ€§èƒ½
- æ›´æ–°æ“ä½œåŠæ—¶æ¸…ç†ç¼“å­˜
- ç¼“å­˜keyåŒ…å«ç§Ÿæˆ·ä¿¡æ¯ï¼Œé¿å…æ•°æ®æ³„éœ²
- è®¾ç½®åˆç†çš„ç¼“å­˜è¿‡æœŸæ—¶é—´

## ğŸ“‹ æ•°æ®è¿ç§»è§„åˆ™

### 1. æ•°æ®åº“ç‰ˆæœ¬ç®¡ç†
```sql
-- âœ… ç‰ˆæœ¬ç®¡ç†SQLæ–‡ä»¶å‘½å
V1.0.0__åˆå§‹åŒ–æ•°æ®åº“ç»“æ„.sql
V1.0.1__æ·»åŠ è´¦å·çŠ¶æ€å­—æ®µ.sql  
V1.1.0__åˆ›å»ºæ¶ˆæ¯æ¨¡æ¿è¡¨.sql
V1.1.1__ä¿®æ”¹æ¶ˆæ¯å­—æ®µé•¿åº¦.sql

-- æ–‡ä»¶å†…å®¹è§„èŒƒ
-- ç‰ˆæœ¬: V1.1.0
-- æè¿°: åˆ›å»ºæ¶ˆæ¯æ¨¡æ¿è¡¨
-- ä½œè€…: developer@company.com
-- æ—¥æœŸ: 2024-01-15

CREATE TABLE message_templates (
    id VARCHAR(36) PRIMARY KEY COMMENT 'æ¨¡æ¿ID',
    tenant_id VARCHAR(36) NOT NULL COMMENT 'ç§Ÿæˆ·ID',
    template_name VARCHAR(100) NOT NULL COMMENT 'æ¨¡æ¿åç§°',
    -- å…¶ä»–å­—æ®µ...
    
    INDEX idx_tenant_id (tenant_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 
  COMMENT='æ¶ˆæ¯æ¨¡æ¿è¡¨';
```

**è§„åˆ™**:
- SQLæ–‡ä»¶æŒ‰ç‰ˆæœ¬å·å‘½å
- æ¯ä¸ªæ–‡ä»¶åŒ…å«ç‰ˆæœ¬ä¿¡æ¯å’Œå˜æ›´æè¿°
- ç¦æ­¢ä¿®æ”¹å·²æ‰§è¡Œçš„å†å²SQLæ–‡ä»¶
- æ•°æ®è¿ç§»è„šæœ¬å¿…é¡»æ”¯æŒå›æ»š

### 2. æ•°æ®å¤‡ä»½æ¢å¤
```bash
# âœ… æ­£ç¡®çš„å¤‡ä»½ç­–ç•¥
# å…¨é‡å¤‡ä»½
mysqldump --single-transaction --routines --triggers \
  --all-databases > backup_$(date +%Y%m%d_%H%M%S).sql

# å¢é‡å¤‡ä»½(åŸºäºbinlog)
mysqlbinlog --start-datetime="2024-01-01 00:00:00" \
  --stop-datetime="2024-01-02 00:00:00" \
  mysql-bin.000001 > incremental_backup.sql
```

**è§„åˆ™**:
- æ¯æ—¥å‡Œæ™¨æ‰§è¡Œå…¨é‡å¤‡ä»½
- æ¯å°æ—¶æ‰§è¡Œå¢é‡å¤‡ä»½
- å¤‡ä»½æ–‡ä»¶ä¿ç•™30å¤©
- å®šæœŸéªŒè¯å¤‡ä»½æ–‡ä»¶å®Œæ•´æ€§# ğŸ’¾ æ•°æ®åº“è®¾è®¡å’Œæ“ä½œè§„åˆ™

## ğŸ“Š æ•°æ®åº“è®¾è®¡è§„èŒƒ

### 1. è¡¨è®¾è®¡è§„èŒƒ
```sql
-- âœ… æ­£ç¡®çš„è¡¨è®¾è®¡æ¨¡æ¿
CREATE TABLE {business_entity} (
    -- ä¸»é”®è®¾è®¡
    id VARCHAR(36) PRIMARY KEY COMMENT 'ä¸»é”®ID(UUID)',
    
    -- å¤šç§Ÿæˆ·å­—æ®µ(å¿…é¡»)
    tenant_id VARCHAR(36) NOT NULL COMMENT 'ç§Ÿæˆ·ID',
    
    -- ä¸šåŠ¡å­—æ®µ
    {business_field} VARCHAR(100) NOT NULL COMMENT 'ä¸šåŠ¡å­—æ®µ',
    
    -- çŠ¶æ€å­—æ®µ
    status ENUM('active', 'inactive', 'deleted') DEFAULT 'active' COMMENT 'çŠ¶æ€',
    
    -- å®¡è®¡å­—æ®µ(å¿…é¡»)
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT 'æ›´æ–°æ—¶é—´',
    created_by VARCHAR(36) DEFAULT NULL COMMENT 'åˆ›å»ºäººID',
    updated_by VARCHAR(36) DEFAULT NULL COMMENT 'æ›´æ–°äººID',
    
    -- è½¯åˆ é™¤å­—æ®µ
    deleted_at TIMESTAMP NULL DEFAULT NULL COMMENT 'åˆ é™¤æ—¶é—´',
    
    -- ç‰ˆæœ¬æ§åˆ¶(å¯é€‰)
    version INT DEFAULT 1 COMMENT 'ç‰ˆæœ¬å·',
    
    -- ç´¢å¼•è®¾è®¡
    INDEX idx_tenant_id (tenant_id),
    INDEX idx_status (status),
    INDEX idx_created_at (created_at),
    INDEX idx_tenant_status (tenant_id, status),
    
    -- å¤–é”®çº¦æŸ
    FOREIGN KEY (tenant_id) REFERENCES saas_tenants(id) ON DELETE CASCADE
    
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci 
  COMMENT='{è¡¨çš„ä¸­æ–‡æè¿°}';
```

**è§„åˆ™**:
- ä¸»é”®ç»Ÿä¸€ä½¿ç”¨VARCHAR(36)å­˜å‚¨UUID
- æ‰€æœ‰ä¸šåŠ¡è¡¨å¿…é¡»åŒ…å«tenant_idå­—æ®µ
- å¿…é¡»åŒ…å«created_atã€updated_atå®¡è®¡å­—æ®µ
- ä½¿ç”¨è½¯åˆ é™¤ï¼Œæ·»åŠ deleted_atå­—æ®µ
- è¡¨åå’Œå­—æ®µåä½¿ç”¨snake_caseå‘½åæ³•
- å¿…é¡»æ·»åŠ è¡¨å’Œå­—æ®µçš„COMMENTæ³¨é‡Š

### 2. å‘½åè§„èŒƒ
```sql
-- âœ… æ­£ç¡®çš„å‘½å
è¡¨å: wework_accounts, message_templates, tenant_quotas
å­—æ®µå: tenant_id, account_name, created_at, is_active
ç´¢å¼•å: idx_tenant_id, idx_status, idx_tenant_status
å¤–é”®å: fk_accounts_tenant_id

-- âŒ é”™è¯¯çš„å‘½å  
è¡¨å: WeWorkAccount, messageTemplate, TenantQuota
å­—æ®µå: tenantId, accountName, createdAt, isActive
ç´¢å¼•å: index1, idx1, tenant_index
å¤–é”®å: fk1, foreign_key_1
```

**è§„åˆ™**:
- è¡¨åä½¿ç”¨å¤æ•°å½¢å¼
- å­—æ®µåæè¿°æ€§å¼ºï¼Œé¿å…ç¼©å†™
- ç´¢å¼•åä»¥idx_å¼€å¤´ï¼Œæè¿°åŒ…å«çš„å­—æ®µ
- å¤–é”®åä»¥fk_å¼€å¤´ï¼Œè¡¨æ˜å…³è”å…³ç³»

### 3. æ•°æ®ç±»å‹è§„èŒƒ
```sql
-- âœ… æ­£ç¡®çš„æ•°æ®ç±»å‹é€‰æ‹©
id VARCHAR(36)              -- UUIDä¸»é”®
tenant_id VARCHAR(36)       -- å¤–é”®ID
name VARCHAR(100)           -- çŸ­æ–‡æœ¬
description TEXT            -- é•¿æ–‡æœ¬  
config JSON                 -- å¤æ‚é…ç½®
amount DECIMAL(10,2)        -- é‡‘é¢
count INT                   -- è®¡æ•°
is_active BOOLEAN           -- å¸ƒå°”å€¼
created_at TIMESTAMP        -- æ—¶é—´æˆ³
status ENUM('active','inactive') -- çŠ¶æ€æšä¸¾

-- âŒ é”™è¯¯çš„æ•°æ®ç±»å‹
id INT AUTO_INCREMENT       -- ä¸ä½¿ç”¨è‡ªå¢ID
name VARCHAR(255)           -- è¿‡é•¿çš„å­—ç¬¦ä¸²
config TEXT                 -- åº”è¯¥ç”¨JSON
amount FLOAT                -- ç²¾åº¦é—®é¢˜
created_at DATETIME         -- åº”è¯¥ç”¨TIMESTAMP
```

**è§„åˆ™**:
- ä¸»é”®å’Œå¤–é”®ç»Ÿä¸€ä½¿ç”¨VARCHAR(36)
- çŸ­æ–‡æœ¬å­—æ®µæ ¹æ®å®é™…éœ€è¦è®¾ç½®é•¿åº¦
- é…ç½®ä¿¡æ¯ä½¿ç”¨JSONç±»å‹
- é‡‘é¢ä½¿ç”¨DECIMALç±»å‹
- æ—¶é—´å­—æ®µä½¿ç”¨TIMESTAMPç±»å‹
- çŠ¶æ€å­—æ®µä½¿ç”¨ENUMç±»å‹

## ğŸ—ï¸ åˆ†åº“åˆ†è¡¨è§„åˆ™

### 1. æ•°æ®åº“æ‹†åˆ†ç­–ç•¥
```yaml
æ•°æ®åº“æ‹†åˆ†è§„èŒƒ:
  saas_unified_core:
    - ç”¨é€”: ç»Ÿä¸€èº«ä»½è®¤è¯ã€æƒé™ç®¡ç†ã€ç³»ç»Ÿé…ç½®
    - ç‰¹ç‚¹: æ•°æ®é‡ç›¸å¯¹è¾ƒå°ï¼ŒæŸ¥è¯¢é¢‘ç¹
    - è¡¨æ•°: 24å¼ è¡¨
    
  ai_agent_platform:  
    - ç”¨é€”: AIæ™ºèƒ½ä½“ç®¡ç†ã€è°ƒåº¦ã€ç›‘æ§
    - ç‰¹ç‚¹: å¤æ‚ä¸šåŠ¡é€»è¾‘ï¼Œéœ€è¦ä¿ç•™å®Œæ•´åŠŸèƒ½
    - è¡¨æ•°: 20å¼ è¡¨
    
  wework_platform:
    - ç”¨é€”: ä¼å¾®è´¦å·ç®¡ç†ã€çŠ¶æ€è·Ÿè¸ª
    - ç‰¹ç‚¹: 9ç§çŠ¶æ€è·Ÿè¸ªï¼Œç”Ÿå‘½å‘¨æœŸç®¡ç†
    - è¡¨æ•°: 15å¼ è¡¨
    
  health_management:
    - ç”¨é€”: å¥åº·ç®¡ç†ã€ä½“æ£€é¢„çº¦
    - ç‰¹ç‚¹: ä¸šåŠ¡ç›¸å¯¹ç‹¬ç«‹
    - è¡¨æ•°: 12å¼ è¡¨
    
  core_business:
    - ç”¨é€”: æœåŠ¡äº§å“ã€è®¢å•ã€è¥é”€
    - ç‰¹ç‚¹: äº¤æ˜“æ ¸å¿ƒï¼Œé«˜å¹¶å‘è®¿é—®
    - è¡¨æ•°: 15å¼ è¡¨
    
  customer_management:
    - ç”¨é€”: å®¢æˆ·ç®¡ç†ã€æ ‡ç­¾ã€åˆ†ç¾¤
    - ç‰¹ç‚¹: æ•°æ®åˆ†æéœ€æ±‚è¾ƒå¤§
    - è¡¨æ•°: 12å¼ è¡¨
```

**è§„åˆ™**:
- æŒ‰ä¸šåŠ¡åŸŸè¿›è¡Œæ•°æ®åº“æ‹†åˆ†
- é¿å…è·¨åº“JOINæŸ¥è¯¢
- é€šè¿‡æœåŠ¡è°ƒç”¨å®ç°è·¨åº“æ•°æ®è·å–

### 2. åˆ†åŒºè¡¨è®¾è®¡
```sql
-- âœ… å¤§æ•°æ®é‡è¡¨ä½¿ç”¨åˆ†åŒº
CREATE TABLE message_records (
    id VARCHAR(36) PRIMARY KEY,
    tenant_id VARCHAR(36) NOT NULL,
    content TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    
    INDEX idx_tenant_created (tenant_id, created_at)
) ENGINE=InnoDB
  PARTITION BY RANGE (UNIX_TIMESTAMP(created_at)) (
    PARTITION p202401 VALUES LESS THAN (UNIX_TIMESTAMP('2024-02-01')),
    PARTITION p202402 VALUES LESS THAN (UNIX_TIMESTAMP('2024-03-01')),
    PARTITION p202403 VALUES LESS THAN (UNIX_TIMESTAMP('2024-04-01')),
    PARTITION p_future VALUES LESS THAN MAXVALUE
);
```

**è§„åˆ™**:
- å¤§æ•°æ®é‡è¡¨(>1000ä¸‡è¡Œ)å¿…é¡»ä½¿ç”¨åˆ†åŒº
- ä¼˜å…ˆæŒ‰æ—¶é—´åˆ†åŒºï¼Œä¾¿äºæ•°æ®æ¸…ç†
- é¢„åˆ›å»ºæœªæ¥åˆ†åŒºï¼Œé¿å…æ•°æ®æ’å…¥å¤±è´¥

## ğŸ’½ ç´¢å¼•ä¼˜åŒ–è§„åˆ™

### 1. ç´¢å¼•è®¾è®¡åŸåˆ™
```sql
-- âœ… æ­£ç¡®çš„ç´¢å¼•è®¾è®¡
-- å•åˆ—ç´¢å¼•
INDEX idx_tenant_id (tenant_id),
INDEX idx_status (status),
INDEX idx_created_at (created_at),

-- å¤åˆç´¢å¼•(æœ€å¸¸ç”¨æŸ¥è¯¢æ¡ä»¶åœ¨å‰)
INDEX idx_tenant_status (tenant_id, status),
INDEX idx_tenant_created (tenant_id, created_at),
INDEX idx_tenant_status_created (tenant_id, status, created_at),

-- è¦†ç›–ç´¢å¼•(åŒ…å«SELECTå­—æ®µ)
INDEX idx_tenant_cover (tenant_id, status, name, created_at),

-- âŒ é”™è¯¯çš„ç´¢å¼•è®¾è®¡
INDEX idx_bad1 (created_at, tenant_id),  -- é¡ºåºé”™è¯¯
INDEX idx_bad2 (name, description),      -- ä½é€‰æ‹©æ€§å­—æ®µåœ¨å‰
INDEX idx_redundant (tenant_id),         -- å·²å­˜åœ¨å¤åˆç´¢å¼•
```

**è§„åˆ™**:
- é«˜é€‰æ‹©æ€§å­—æ®µåœ¨å‰(tenant_idä¼˜å…ˆ)
- æŸ¥è¯¢æ¡ä»¶å­—æ®µåœ¨å‰ï¼Œæ’åºå­—æ®µåœ¨å
- é¿å…è¿‡å¤šç´¢å¼•ï¼Œå½±å“å†™å…¥æ€§èƒ½
- å®šæœŸåˆ†ææ…¢æŸ¥è¯¢ï¼Œä¼˜åŒ–ç´¢å¼•

### 2. æŸ¥è¯¢ä¼˜åŒ–è§„èŒƒ
```sql
-- âœ… æ­£ç¡®çš„æŸ¥è¯¢å†™æ³•
SELECT id, name, status, created_at 
FROM wework_accounts 
WHERE tenant_id = ? 
  AND status = 'active' 
  AND created_at >= ?
ORDER BY created_at DESC 
LIMIT 20;

-- âŒ é”™è¯¯çš„æŸ¥è¯¢å†™æ³•
SELECT * FROM wework_accounts           -- é¿å…SELECT *
WHERE name LIKE '%keyword%'             -- é¿å…å·¦æ¨¡ç³ŠæŸ¥è¯¢
  OR description LIKE '%keyword%'       -- é¿å…ORæŸ¥è¯¢
ORDER BY created_at                     -- ç¼ºå°‘LIMIT
```

**è§„åˆ™**:
- é¿å…SELECT *ï¼Œæ˜ç¡®æŒ‡å®šå­—æ®µ
- WHEREæ¡ä»¶å¿…é¡»åŒ…å«tenant_id
- é¿å…å·¦æ¨¡ç³ŠæŸ¥è¯¢å’ŒORæ¡ä»¶
- å¤§ç»“æœé›†å¿…é¡»ä½¿ç”¨LIMITåˆ†é¡µ

## ğŸ”„ æ•°æ®æ“ä½œè§„èŒƒ

### 1. äº‹åŠ¡å¤„ç†
```java
// âœ… æ­£ç¡®çš„äº‹åŠ¡å¤„ç†
@Service
@Transactional(rollbackFor = Exception.class)
public class AccountService {
    
    // åªè¯»äº‹åŠ¡
    @Transactional(readOnly = true)
    public AccountDTO getAccount(String tenantId, String accountId) {
        return accountMapper.selectByTenantAndId(tenantId, accountId);
    }
    
    // å†™äº‹åŠ¡
    @Transactional(rollbackFor = Exception.class)
    public void createAccount(CreateAccountRequest request) {
        // 1. éªŒè¯æƒé™
        tenantQuotaService.checkAccountQuota(request.getTenantId());
        
        // 2. åˆ›å»ºè´¦å·
        WeWorkAccount account = new WeWorkAccount();
        account.setTenantId(request.getTenantId());
        accountMapper.insert(account);
        
        // 3. è®°å½•å®¡è®¡æ—¥å¿—
        auditLogService.logAccountCreated(account);
        
        // 4. å‘é€äº‹ä»¶
        eventPublisher.publishAccountCreated(account);
    }
}
```

**è§„åˆ™**:
- æ˜ç¡®æŒ‡å®šrollbackFor = Exception.class
- æŸ¥è¯¢æ“ä½œä½¿ç”¨readOnly = true
- äº‹åŠ¡èŒƒå›´å°½å¯èƒ½å°ï¼Œé¿å…é•¿äº‹åŠ¡
- äº‹åŠ¡å†…é¿å…è°ƒç”¨å¤–éƒ¨æœåŠ¡

### 2. æ‰¹é‡æ“ä½œ
```java
// âœ… æ­£ç¡®çš„æ‰¹é‡æ“ä½œ
@Service
public class MessageService {
    
    public void batchCreateMessages(List<MessageDTO> messages) {
        if (CollectionUtils.isEmpty(messages)) {
            return;
        }
        
        // åˆ†æ‰¹å¤„ç†ï¼Œé¿å…å¤§äº‹åŠ¡
        int batchSize = 100;
        for (int i = 0; i < messages.size(); i += batchSize) {
            int end = Math.min(i + batchSize, messages.size());
            List<MessageDTO> batch = messages.subList(i, end);
            batchInsertMessages(batch);
        }
    }
    
    @Transactional(rollbackFor = Exception.class)
    private void batchInsertMessages(List<MessageDTO> batch) {
        messageMapper.batchInsert(batch);
    }
}
```

**è§„åˆ™**:
- å¤§æ‰¹é‡æ“ä½œåˆ†æ‰¹å¤„ç†ï¼Œå•æ‰¹æ¬¡ä¸è¶…è¿‡1000æ¡
- ä½¿ç”¨MyBatis-Plusçš„æ‰¹é‡æ’å…¥åŠŸèƒ½
- æ‰¹é‡æ“ä½œå‰éªŒè¯ç§Ÿæˆ·æƒé™

### 3. ç¼“å­˜ç­–ç•¥
```java
// âœ… æ­£ç¡®çš„ç¼“å­˜ä½¿ç”¨
@Service
public class ConfigService {
    
    @Cacheable(value = "tenant-config", key = "#tenantId")
    public TenantConfigDTO getTenantConfig(String tenantId) {
        return configMapper.selectByTenantId(tenantId);
    }
    
    @CacheEvict(value = "tenant-config", key = "#config.tenantId")
    public void updateTenantConfig(TenantConfigDTO config) {
        configMapper.updateByTenantId(config);
    }
    
    @CacheEvict(value = "tenant-config", allEntries = true)
    public void clearAllCache() {
        // æ¸…ç©ºæ‰€æœ‰ç¼“å­˜
    }
}
```

**è§„åˆ™**:
- é…ç½®ä¿¡æ¯ä½¿ç”¨ç¼“å­˜ï¼Œæå‡æŸ¥è¯¢æ€§èƒ½
- æ›´æ–°æ“ä½œåŠæ—¶æ¸…ç†ç¼“å­˜
- ç¼“å­˜keyåŒ…å«ç§Ÿæˆ·ä¿¡æ¯ï¼Œé¿å…æ•°æ®æ³„éœ²
- è®¾ç½®åˆç†çš„ç¼“å­˜è¿‡æœŸæ—¶é—´

## ğŸ“‹ æ•°æ®è¿ç§»è§„åˆ™

### 1. æ•°æ®åº“ç‰ˆæœ¬ç®¡ç†
```sql
-- âœ… ç‰ˆæœ¬ç®¡ç†SQLæ–‡ä»¶å‘½å
V1.0.0__åˆå§‹åŒ–æ•°æ®åº“ç»“æ„.sql
V1.0.1__æ·»åŠ è´¦å·çŠ¶æ€å­—æ®µ.sql  
V1.1.0__åˆ›å»ºæ¶ˆæ¯æ¨¡æ¿è¡¨.sql
V1.1.1__ä¿®æ”¹æ¶ˆæ¯å­—æ®µé•¿åº¦.sql

-- æ–‡ä»¶å†…å®¹è§„èŒƒ
-- ç‰ˆæœ¬: V1.1.0
-- æè¿°: åˆ›å»ºæ¶ˆæ¯æ¨¡æ¿è¡¨
-- ä½œè€…: developer@company.com
-- æ—¥æœŸ: 2024-01-15

CREATE TABLE message_templates (
    id VARCHAR(36) PRIMARY KEY COMMENT 'æ¨¡æ¿ID',
    tenant_id VARCHAR(36) NOT NULL COMMENT 'ç§Ÿæˆ·ID',
    template_name VARCHAR(100) NOT NULL COMMENT 'æ¨¡æ¿åç§°',
    -- å…¶ä»–å­—æ®µ...
    
    INDEX idx_tenant_id (tenant_id)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 
  COMMENT='æ¶ˆæ¯æ¨¡æ¿è¡¨';
```

**è§„åˆ™**:
- SQLæ–‡ä»¶æŒ‰ç‰ˆæœ¬å·å‘½å
- æ¯ä¸ªæ–‡ä»¶åŒ…å«ç‰ˆæœ¬ä¿¡æ¯å’Œå˜æ›´æè¿°
- ç¦æ­¢ä¿®æ”¹å·²æ‰§è¡Œçš„å†å²SQLæ–‡ä»¶
- æ•°æ®è¿ç§»è„šæœ¬å¿…é¡»æ”¯æŒå›æ»š

### 2. æ•°æ®å¤‡ä»½æ¢å¤
```bash
# âœ… æ­£ç¡®çš„å¤‡ä»½ç­–ç•¥
# å…¨é‡å¤‡ä»½
mysqldump --single-transaction --routines --triggers \
  --all-databases > backup_$(date +%Y%m%d_%H%M%S).sql

# å¢é‡å¤‡ä»½(åŸºäºbinlog)
mysqlbinlog --start-datetime="2024-01-01 00:00:00" \
  --stop-datetime="2024-01-02 00:00:00" \
  mysql-bin.000001 > incremental_backup.sql
```

**è§„åˆ™**:
- æ¯æ—¥å‡Œæ™¨æ‰§è¡Œå…¨é‡å¤‡ä»½
- æ¯å°æ—¶æ‰§è¡Œå¢é‡å¤‡ä»½
- å¤‡ä»½æ–‡ä»¶ä¿ç•™30å¤©
- å®šæœŸéªŒè¯å¤‡ä»½æ–‡ä»¶å®Œæ•´æ€§