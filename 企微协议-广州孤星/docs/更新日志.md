# 更新日志

# v2.7.0
1. 修复部分账号发送小程序，返回`-4046`错误
2. 发送群引用消息支持AT群成员
3. 发送聊天合集支持视频号和视频号直播消息
# v2.6.9
1. 修复心跳返回 `-15001500` 造成用户退出问题
# v2.6.8
1. 接收聊天合集消息中新增`extra_content`字段
# v2.6.7
1. 修复发聊天合集包含嵌套聊天合集时, 苹果手机端显示合集标题为null问题
# v2.6.6
1. 修复`4.1.36`发送小程序 `-4046`错误
# v2.6.5
1. 新增语音相关通知, `msg_type = 40`
# v2.6.4
1. 新增支持kafka通知配置
   ```ini
   notify_kafka_enable = False
   notify_kafka_logger_enable = False
   notify_kafka_bootstrap_servers = localhost:9092
   notify_kafka_topic = weworkMessage
   notify_kafka_compression_type = gzip
   notify_kafka_acks = all
   ```
# v2.6.3
1. 接收消息新增`extra_content`字段，用于转发合并聊天消息
2. 解决高于4.1.31版本，发送聊天合集消息失败的问题
# v2.6.2
1. 图片消息新增`image_width` 和 `image_height` 字段
# v2.6.1
1. 修复引用报错问题
# v2.6.0
1. 新增设置登录用户的头像 `/user/modify_head_img`
2. 新增设置登录用户姓名 `/user/modify_name`
3. 新增设置登录用户别名 `/user/modify_alias`
4. 新增支持`Mac，iPad 4.1.36`版本, 目前client_type清单：
   - 241: Windows 4.1.2
   - 242: iPad 4.1.2
   - 243: Windows 4.1.10
   - 244: Mac 4.1.2
   - 245: Mac 4.1.16
   - 246: iPad 4.1.16
   - 247: iPad 4.1.22
   - 248: Mac 4.1.22
   - 249: iPad 4.1.26
   - 250: Mac 4.1.26
   - 251: iPad 4.1.27
   - 252: Mac 4.1.27
   - 253: iPad 4.1.28
   - 254: Mac 4.1.28
   - 255: iPad 4.1.30
   - 256: Mac 4.1.30
   - 257: iPad 4.1.31
   - 258: Mac 4.1.31
   - 259: iPad 4.1.32
   - 260: Mac 4.1.32 
   - 261: iPad 4.1.36
   - 262: Mac 4.1.36
# v2.5.9
1. 新增接龙消息 `msg_type=20`
# v2.5.8
1. 新增获取绑定的微信号信息 `/user/get_bind_wxinfo`
2. 支持Minio分布式的对象存储系统, 配置项如下：
   ```ini
   cloud_storage = minio
   minio_endpoint = 127.0.0.1:9000
   minio_endpoint_is_secure = False
   minio_bucket = wework
   minio_access_key = 3OH9kGjTbpOXzTakvG9r
   minio_secret_key = uWbyDOlqF9fAtBm7Q1nYZjKbrpmZ6L3LddDx6Esi
   ```
# v2.5.7
1. 发送聊天合集的消息中添加 `sendtime` 字段
   ```json
           {
            "sender": "7881300714912093",  // or sender_user_id
            "sender_name": "发送人",
            "sendtime": 1737360028,
            "msg_type": 2,
            "content": "文本消息"
          }
   ```
2. 新增获取群模板 `/room/get_room_templates`
3. 新增应用群模板 `/room/apply_room_templates_to_rooms`
# v2.5.6
1. 设置会话命令支持标记和取消标记 `/session/set_session_cmd`
2. 发送聊天合集支持大文件和大视频消息
# v2.5.5
1. 极速群发新增发送文件 `/msg/send_group_msg` 中 `file_msg_list`
```json
   {
       "file_id": "",
       "size": 1024,
       "file_name": "xxxx",
       "aes_key": "",
       "md5": ""
   }
   ```
3. 发送引用消息新增字段 `sender_name`
# v2.5.4
1. 新增获取群发任务详情 `/msg/get_group_msg_detail`
2. 新增获取群发任务要发送的群列表 `/msg/query_group_msg_room_list`
# v2.5.3
1. 新增通过二维码名片添加微信用户 `/contact/add_wx_card_contact`
2. 新增支持`Mac，iPad 4.1.32`版本, 目前client_type清单：
   - 241: Windows 4.1.2
   - 242: iPad 4.1.2
   - 243: Windows 4.1.10
   - 244: Mac 4.1.2
   - 245: Mac 4.1.16
   - 246: iPad 4.1.16
   - 247: iPad 4.1.22
   - 248: Mac 4.1.22
   - 249: iPad 4.1.26
   - 250: Mac 4.1.26
   - 251: iPad 4.1.27
   - 252: Mac 4.1.27
   - 253: iPad 4.1.28
   - 254: Mac 4.1.28
   - 255: iPad 4.1.30
   - 256: Mac 4.1.30
   - 257: iPad 4.1.31
   - 258: Mac 4.1.31
   - 259: iPad 4.1.32
   - 260: Mac 4.1.32
# v2.5.2
1. 修复心跳超时，不断重连的问题
2. 在收到掉线后尝试一次登录，如果失败在强制离线
3. 优化上报策略和细节
# v2.5.1
1. 修复管理员下发群发消息任务通知 `notify_type = 573`
2. 新增管理员下发朋友圈任务通知 `notify_type = 529`
3. 新增确认发布管理员下发朋友圈任务接口 `/sns/confirm_send_sns_task`
# v2.5.0
1. 新增支持`Mac，iPad 4.1.31`版本, 目前client_type清单：
   - 241: Windows 4.1.2
   - 242: iPad 4.1.2
   - 243: Windows 4.1.10
   - 244: Mac 4.1.2
   - 245: Mac 4.1.16
   - 246: iPad 4.1.16
   - 247: iPad 4.1.22
   - 248: Mac 4.1.22
   - 249: iPad 4.1.26
   - 250: Mac 4.1.26
   - 251: iPad 4.1.27
   - 252: Mac 4.1.27
   - 253: iPad 4.1.28
   - 254: Mac 4.1.28
   - 255: iPad 4.1.30
   - 256: Mac 4.1.30
   - 257: iPad 4.1.31
   - 258: Mac 4.1.31
# v2.4.9
1. 修复在心跳失败时没有通知下线的问题
2. 新增管理员下发消息通知 `notify_type = 573`
3. 新增查询管理员下发的群发消息 `/msg/query_group_msg_confirm_list`
4. 新增查询群发确认的消息的状态 `/msg/sync_group_msg_send_status`
5. 新增确认群发消息 `/msg/confirm_group_msg`
6. 极速群发新增发视频号 `/msg/send_group_msg` 中 `feed_video_msg_list`
# v2.4.8
1. 在恢复登录时，使用保持登录的方式来替代自动登录
# v2.4.7
1. `/cloud/cdn_wx_donwload` 同时支持个微和企微url下载
2. 修复置顶客户会话时，显示错误问题 `/session/set_session_cmd`
# v2.4.6
4. 修复 `/cloud/cdn_wx_donwload` 接口下载失败问题
# v2.4.5
1. 修复 `/room/modify_room_auto_reply` 开启后，没有拉机器人进群的问题
# v2.4.4
1. 修复`room/sync_room_info`返回 `version` 错误问题
# v2.4.3
1. 修复接口返回`-11001`错误问题
# v2.4.2
1. 新增开启/关闭群自动回复 `/room/modify_room_auto_reply` 
2. 发送聊天合集支持在消息中设置发送人  `sender_user_id` 和 `sender_name`
# v2.4.1
5. 修复`-11001`错误
6. 支持客服消息处理， 接收消息新增`asid`字段，发送时`converstation_id`格式为`S:{userid};{asid}`
# v2.4.0 
1. 新增判断目标客户是否可以极速群发接口 `/msg/check_can_send_group_msg`
2. 新增开启/关闭禁止互相添加为联系人、禁止修改群名接口 `/room/modify_room_admin_flag`
3. 废弃旧的禁止修改群名接口 `/room/modify_name_guard_status`
4. 新增支持`Mac，iPad 4.1.30`版本, 目前client_type清单：
   - 241: Windows 4.1.2
   - 242: iPad 4.1.2
   - 243: Windows 4.1.10
   - 244: Mac 4.1.2
   - 245: Mac 4.1.16
   - 246: iPad 4.1.16
   - 247: iPad 4.1.22
   - 248: Mac 4.1.22
   - 249: iPad 4.1.26
   - 250: Mac 4.1.26
   - 251: iPad 4.1.27
   - 252: Mac 4.1.27
   - 253: iPad 4.1.28
   - 254: Mac 4.1.28
   - 255: iPad 4.1.30
   - 256: Mac 4.1.30
# v2.3.9
1. CDN下载增加 `to_mp3` 参数，支持silk格式语言自动转码为mp3格式 `/cloud/cdn_c2c_download`
# v2.3.8
1. 修复长连接被断开没有重连问题 `[Errno 104] Connection reset by peer`
# v2.3.7
1. 新增群成员邀请确认通知 `notify_type = 2116`
2. 新增群邀请确认接口 `room/confirm_add_member`
# v2.3.6
1. 新增发送微信小店商品消息 `/msg/send_finder_product`
2. 新增接收微信小店商品消息 `msg_type = 19`
# v2.3.5
1. 新增会话置顶、群折叠和免打扰等配置信息  `/session/get_session_config`
2. 新增会话配置信息变更通知 `notify_type = 2115`
# v2.3.4
1. 修复同步消息返回-7003, -7002, -7019造成用户退出问题
2. 增加发送大视频消息接口 `/msg/send_big_video`
3. 新增上传视频预览图接口 `/cloud/upload_video_preview`
# v2.3.3 
1. 修复同步消息返回-2和-202造成用户退出问题
# v2.3.2
1. 新增支持`Mac，iPad 4.1.28`版本
   - 253: iPad 4.1.28
   - 254: Mac 4.1.28
# v2.3.1
1. 新增支持`Mac，iPad 4.1.27`版本
   - 251: iPad 4.1.27
   - 252: Mac 4.1.27
# v2.3.0
1. 新增将联系人加入和移除黑名单 `/contact/op_black_list`
# v2.2.9
1. 修复同步消息遇到Magic错误和-6000错误，造成账号下线问题
2. 增加朋友圈变动通知， notify_type=2215
3. 修复图文消息接收顺序，改用msg_list字段存放消息内容
4. 增加企微用户发起的语言和视频通知 notify_type=2120
# v2.2.8
1. 新增手机上已读会话消息通知 `msg_type = 1012`
# v2.2.7
1. 支持发送引用消息 `/msg/send_quote_msg`
2. 新增支持Mac，iPad 4.1.26版本
   - iPad 4.1.26 版本，client_type: 249
   - Mac 4.1.26 版本，client_type: 250
# v2.2.6
1. 优化消息同步机制
2. 语音和视频通话消息通知, 修复type 1视频 2语音
# v2.2.5
1. 修复接收带小程序的聊天合集消息报错问题
2. 在登录阶段，当使用bridge无效时，会失败并通知
# v2.2.4
1. 修复`/sync/sync_msg`返回内容中`continue_flag`字段不准确问题
2. 新增语音和视频通话消息通知 notify_type = 2166
# v2.2.3
1. 修复同步消息不及时问题
# v2.2.1
1. 修复iPad4.1.22版本上报问题
2. 新增`/contact/get_contact_by_qrcode`接口，通过二维码获取联系人信息
# v2.2.0
1. 修复Mac4.1.22版本上报问题
# v2.1.9
1. 新增接收转账消息通知 msg_type = 18, 其中字段`transfer_type`表示转账类型，1：转账，2：收款
2. 新增/client/get_client_status接口，获取客户端状态
3. 新增/client/get_client_version接口，获取客户端版本信息
4. 修复cdn上传和下载异常造成临时文件没有删除问题
5. 修复/client/set_proxy接口，设置代理后重连多次问题
# v2.1.8
1. 新增/client/update_client 升级客户端接口
# v2.1.7
1. 新增iPad 4.1.22 版本，client_type: 247
2. 新增Mac 4.1.22 版本，client_type: 248
# v2.1.6
1. 修复`client/set_proxy`接口, 设置后没有重连问题
# v2.1.5
1. wework_service 增加命令行参数 `--config` 用于指定配置文件
# v2.1.4
1. 群AT消息内容新增AT对象昵称
# v2.1.3
1. 新增/sync/push_sync_msg接口，用于主动推送同步消息
2. 新增视频号直播消息通知  msg_type = 17
3. 新增发送视频号直播 /msg/send_feed_live
4. 修复批量获取群信息太多报错问题 /room/batch_get_room_detail
# v2.1.2
1. 接收图片消息时，新增字段is_hd, 为true时，表示是高清图片
2. /msg/send_msg接口新增字段is_hd, 为true时，表示发送高清图片
# v2.1.1
修复长连断开同步失效问题
# v2.1.0 
新增redis订阅通知， 配置项如下；
```
notify_redis_logger_enable = True
notify_redis_enable = True
notify_redis_host = 127.0.0.1
notify_redis_port = 6379
notify_redis_passwd =
notify_redis_channel = wework:notify
```
# v2.0.9
* 优化性能
* 消息通知 支持批量通知 需要开启配置`msg_notify_batch_enable = True`,然后消息通知以 `notify_type = 11013` 批量通知 `{"data" : [{}]}`
# v2.0.8
* 修复部分cdn下载失败问题
#  v2.0.7
* 新增消息通知新增聊天合集（合并转发的消息）msg_type = 16
* 新增支持发送聊天合集消息（支持深度嵌套，具体参数看我发你的例子文档） /msg/send_forward_msg
* 新增发送 Gif 消息的简化接口 /msg/send_gif_url
* 新增获取群置顶消息列表 /room/get_room_top_msg
* 新增设置群消息置顶 /room/set_room_top_msg
* 新增删除群消息置顶 /room/del_room_top_msg
* 新增获取个人二维码名片新接口 /user/get_qrcode_card_new

# v2.0.6
* 修改同事信息（备注和描述） /arch/modify_colleague_info
* 修改群内昵称 /room/modify_in_room_nickname
* 修改群备注 /room/modify_room_remark
* 删除朋友圈评论 /sns/delete_sns_comment
* 修改标签 /label/modify_label 
* 同步聊天标签列表 /session_tag/get_session_tag_list
* 创建聊天标签 /session_tag/create_session_tag
* 修改聊天标签 /session_tag/mod_session_tag
* 删除聊天标签 /session_tag/del_session_tag
* 同步会话所属标签列表 /session_tag/get_session_in_tag_list
* 修改会话所属标签 /session_tag/mod_session_in_tag
* 新增客户标签信息变动通知 notify_type= 2186

# v2.0.5
* 修复带sqe获取会话报错问题
* 修复部分cdn下载空白问题