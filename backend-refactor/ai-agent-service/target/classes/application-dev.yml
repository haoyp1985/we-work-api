# AI智能体服务 - 开发环境配置
# 使用Docker基础设施的映射端口

server:
  port: 18086

spring:
  application:
    name: ai-agent-service
  profiles:
    active: dev
  
  # 数据源配置 - 使用映射端口
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:23306/ai_agent_platform?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true
    username: wework
    password: wework123456
    hikari:
      maximum-pool-size: 20
      minimum-idle: 5
      connection-timeout: 30000
      idle-timeout: 600000
      max-lifetime: 1800000

  # Redis配置 - 使用映射端口
  redis:
    host: localhost
    port: 26379
    password: 
    database: 6
    lettuce:
      pool:
        max-active: 20
        max-idle: 10
        min-idle: 5
        max-wait: 30000

  # RocketMQ配置 - 使用映射端口
  cloud:
    stream:
      rocketmq:
        binder:
          name-server: localhost:29876
        bindings:
          ai-events-output:
            destination: ai-events
            content-type: application/json
          ai-events-input:
            destination: ai-events
            content-type: application/json
            group: ai-agent-service-group

# Nacos配置 - 使用映射端口
  cloud:
    nacos:
      server-addr: localhost:28848
      discovery:
        namespace: dev
        group: DEFAULT_GROUP
        cluster-name: dev
      config:
        namespace: dev
        group: DEFAULT_GROUP
        file-extension: yml

# MyBatis Plus配置
mybatis-plus:
  configuration:
    map-underscore-to-camel-case: true
    cache-enabled: true
    lazy-loading-enabled: true
    multiple-result-sets-enabled: true
    use-column-label: true
    use-generated-keys: true
    auto-mapping-behavior: partial
    auto-mapping-unknown-column-behavior: none
    default-executor-type: simple
    default-statement-timeout: 25000
    default-fetch-size: 100
    safe-result-handler-enabled: true
    safe-row-bounds-enabled: false
    local-cache-scope: session
    jdbc-type-for-null: other
    lazy-load-trigger-methods: equals,clone,hashCode,toString
  global-config:
    db-config:
      id-type: assign_uuid
      table-underline: true
      capital-mode: false
      logic-delete-field: deleted_at
      logic-delete-value: now()
      logic-not-delete-value: null
  mapper-locations: classpath:mapper/*.xml

# 业务配置
app:
  # AI平台配置
  ai:
    platforms:
      dify:
        enabled: true
        base-url: https://api.dify.ai
        timeout: 30000
        max-retries: 3
      coze:
        enabled: true
        base-url: https://api.coze.cn
        timeout: 30000
        max-retries: 3
      openai:
        enabled: true
        base-url: https://api.openai.com
        timeout: 60000
        max-retries: 3
      claude:
        enabled: true
        base-url: https://api.anthropic.com
        timeout: 60000
        max-retries: 3
      
  # 模型配置
  models:
    default-temperature: 0.7
    default-max-tokens: 2048
    default-top-p: 0.9
    
  # 对话配置
  conversation:
    max-history: 50
    context-window: 8192
    auto-title: true
    
  # 调用记录配置
  call-records:
    enabled: true
    retention-days: 90
    batch-size: 100

# 日志配置
logging:
  level:
    root: INFO
    com.wework.ai: DEBUG
    org.springframework.cloud: DEBUG
    org.springframework.web: DEBUG
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level [%X{traceId:-},%X{spanId:-}] %logger{50} - %msg%n"
  file:
    name: logs/ai-agent-service-dev.log
    max-size: 100MB
    max-history: 30

# Actuator配置
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus,env,configprops
      base-path: /actuator
  endpoint:
    health:
      show-details: always
  health:
    redis:
      enabled: true
    db:
      enabled: true
  metrics:
    export:
      prometheus:
        enabled: true
    tags:
      application: ${spring.application.name}
      environment: dev